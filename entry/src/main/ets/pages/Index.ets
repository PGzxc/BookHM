import Constants from '../utils/Constants';
import { BottomTabsList } from '../viewmodel/BottomTabsModel';
import BookPage from './BookPage';
import MePage from './MePage';
import ReadPage from './ReadPage'
import VoicePage from './VoicePage';

@Entry
@Component
struct Index {
  @State bottomTabIndex: number = 0;
  private tabsController: TabsController = new TabsController();

  @Builder
  TabBuilder(index: number, _name: string) {
    Column() {
      Image(this.bottomTabIndex === index ? BottomTabsList[index].iconSelected : BottomTabsList[index].icon)
        .width(Constants.ICON_SIZE)
        .height(Constants.ICON_SIZE)
        .objectFit(ImageFit.Contain)

      Text(BottomTabsList[index].text)
        .fontSize($r('app.float.10fp'))
        .opacity(Constants.OPACITY)
        .fontColor(this.bottomTabIndex === index ?
        $r('app.color.bottom_tabs_font_color_selected') : $r('app.color.bottom_tabs_font_color'))
    }
    .width(Constants.FULL_PERCENT)
    .height(Constants.FULL_PERCENT)
    .justifyContent(FlexAlign.Center)
    .border({ width: { top: Constants.BORDER_WIDTH }, color: $r('app.color.color_border') })
    .backgroundColor($r('app.color.white'))
  }

  /**
   * In low-code mode, do not add anything to the build function, as it will be
   * overwritten by the content generated by the .visual file in the build phase.
   */
  build() {
    Flex({ direction: FlexDirection.Column, alignItems: ItemAlign.End, justifyContent: FlexAlign.End }) {
      Tabs({ barPosition: BarPosition.End, index: 0, controller: this.tabsController }) {
        TabContent() {
          ReadPage()
        }.tabBar(this.TabBuilder(0, 'Home'))

        TabContent() {
          BookPage()
        }.tabBar(this.TabBuilder(1, 'Nav'))

        TabContent() {
          VoicePage()
        }.tabBar(this.TabBuilder(2, 'Project'))

        TabContent() {
          MePage()
        }.tabBar(this.TabBuilder(3, 'Me'))

      }
      .width(Constants.FULL_PERCENT)
      .height(Constants.FULL_PERCENT)
      .vertical(false)
      .scrollable(false)
      .barMode(BarMode.Fixed)
      .barHeight(Constants.BAR_HEIGHT)
      .onChange((index: number) => {
        this.bottomTabIndex = index;
      })
    }
    .width(Constants.FULL_PERCENT)
  }

  onIndexChange() {
    this.tabsController.changeIndex(this.bottomTabIndex);
  }
}

